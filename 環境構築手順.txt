🛠️ 環境構築マニュアル

※現在読んでもらっている、MOAVLink（Mic OpenAI VOICEVOX Link）に関してこだわりが無ければ下記に格納しておけば分かりやすいです
  環境設定マニュアル内ではMOAVLinkを下記フォルダで管理している体で説明を行います
C:\MOAVLink\
★配置フォルダを変える場合は「start_app.bat」の「cd /d C:\MOAVLink\」も合わせて変えて下さい


✅ 1. 必須ソフトウェアのインストール

| ソフト           | 説明                             | 備考                                                                                          |
|------------------|----------------------------------|-----------------------------------------------------------------------------------------------|
| Python 3.11.x    | このアプリの動作環境に必要       | https://www.python.org/downloads/ にて入手、インストール時に「Add to PATH」をチェック |
| VoiceVoxエンジン | 音声合成のためのローカルサーバー | https://github.com/VOICEVOX/voicevox_engine/releases/tag/0.24.1 からDL、「Assets」セクションにある「windows-directml.zip」など、環境に合ったバイナリをダウンロードし、任意のフォルダに格納（推奨：C:\windows-directml）|



✅ 2. Pythonパッケージのインストール

コマンドプロンプトまたは PowerShell (Windows11であればインストールされている)で以下を実行：

cd C:\MOAVLink\
pip install -r requirements.txt
※最小限のインストール版です足りない場合は、開発で使用していたrequirements(full).txtを試してみてください

✅ 3. OpenAI APIキーの取得と設定

1. https://platform.openai.com にログイン
2. 「API Keys」から新規発行
3. App.config の [CHAT] に貼り付け：

[CHAT]
api_key = sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
※この時、OpenAIに入金していないと機能しないので5$程度入れておけば半月～1か月ほどは遊べる2000～3000往復会話できる計算



✅ 4. VoiceVoxエンジンの起動方法

1. VoiceVoxエンジンフォルダに移動（C:\windows-directml)
2. run.exe を実行（PowerShellの窓が開いてVoiceVoxエンジンを起動)
3. ブラウザで http://127.0.0.1:50021 を入力し（VOICEVOX ENGINE OSS へようこそ！が確認できれば起動している）



✅ 5. マイク入力ごAI会話アプリの起動前の設定
   ①マイク設定: App.config の [RECORDER]
     ┗1.次のバッチファイルを叩いて規定マイクの取得を個なう
         C:\MOAVLink\tool\マイクインデックス取得処理.bat
         ※規定マイクを使わない場合は、次のバッチを叩いてマイクのインデックスIDを取得してください
           C:\MOAVLink\tool\デックス取得処理.bat
       2."C:\MOAVLink\config\app.configのmic_device_index"の値を使用しているマイクの番号に設定する
      
   ②OpenAIのAPI_KYE（鍵設定）: App.config の [KEYS]
     ┗1．https://openai.com/ja-JP/
          上記URLからログインを行う（アカウントが作られていないなら作成が必要）
          ※ログインはAPIプラットフォームを選択すること
       2.右上のタブのDashboardを押下
       3.左側のリストからAPI keysを選択(https://platform.openai.com/api-keys)
       4.右上のボタンで[Create new secret kye]を押下して、情報を設定する
         払い出されたAPI_KEYを覚えておく「sk-proj-xxxxxxxxxx」
       5."C:\MOAVLink\config\app.config"のapi_keyに払い出されたAPI_KEYを貼り付ける

   ③使用する音声のキャラクターを設定する
     ┗1．VoiceVoxエンジンを格納したフォルダ"C:\windows-directml\model\metas.json"をテキストエディタで開いて誰の声にしたいか選ぶ
       2."C:\MOAVLink\config\app.config"のspeaker_id に
        「1．」で選択した声のidをセットする

   ④AIへ送信する会話設定
     ┗1.OpenAIに送信する会話設定は下記の１～３が存在する
          「1」:短期記憶（直近の５往復までの会話を覚えて会話が可能。記憶量は少ないがレスポンスが早くなる）
          「2」:中期記憶（過去3日の会話を要約して覚えている。「1」に比べ1～2秒レスポンスが遅れる）
          「3」:長期記憶（過去情報をローカル内のデータベースに保管し、会話に関するTpo5（デフォルト）を取得し会話に活かす方式。OpenAIに投げるまでの時間が「1」「2」に比べて長くなる」
          ※１～３にかけてOpenAIに投げるトークン量も増える為、3に行くほど会話で発生する料金が増える認識。1000円分ドルレートで150円1ドルの場合大体500往復会話(一往復最大1000トークンで計算)ができるが
            ３の場合200～300往復くらいになる見込み
            前提としGPT-4oを使用した場合で、GPT-4o miniを使用している場合は想定より多く会話をすることが出来る見込み

   ④使用キャラ設定: [CHAT] の character_prompt_file
     ┗1．"C:\MOAVLink\config"のcharacter_prompt.txtを開き設定を付ける
          例：あなたはヒポ子という女の子です。
              性格は「明るく」「ハッキリものを言う」「悪気はない」。
              20歳だが幼く見える。
              ユーザーが好きだけど素直になれないヒロイン体質。
              会話ルール：
             ・ユーザーを必ず「カバおじ」と呼ぶこと
             ・返答は1～2文に収めること
             ・明るい感じで「おかしいね！」「楽しいね！」等の前向きな表現で文章を終えること
             ・たまに「えへへ」「ちょっと恥ずかしい…」など言葉で照れ表現を入れること
             ・特殊文字や顔文字、絵文字は使わないこと
             ・自然な日本語の文章で返すこと

✅ 6. アプリの起動
  1. VoiceVoxエンジンを起動する
  2. 「C:\MOAVLink\start_app.bat」をダブルクリックで起動する


- F9キー押し続ける録音開始、F9キーを放すとAIにメッセージ送信、ESCキーで終了
- 入力 → ChatGPT → 音声出力まで自動で実行されます

💡 補足情報
README記載内容の設定を確認し、下記情報を正しく設定している事
- マイク設定: App.config の [RECORDER]
- 鍵入力: App.config の [KEYS]
- 使用キャラ: [CHAT] の character_prompt_file
- 会話履歴は outputs/conversation_log.json に記録



★★★おまけ★★★

iponeをマイクとスピーカーとして使う場合の対処法
| ソフト                          | 説明                                        | 備考                                                                                       |
|---------------------------------|---------------------------------------------|--------------------------------------------------------------------------------------------|
| VB-CABLE Virtual Audio Device   | 仮想のスピーカーとマイクを作成するよう      | https://vb-audio.com/Cable/?utm_source=chatgpt.com にて入手                                |
| sonobus                         | PCの音をスマホに連携するためのアプリ        | https://sonobus.net/?utm_source=chatgpt.com からDL。スマホ側にもDLしてインストールすること |

✅ SonoBus × MOAVLink 無線マイク＆スピーカー設定手順
1-- 準備
    アプリ導入：
    1.PCに「SonoBus」と「VB-Audio Virtual Cable」をインストール
    2.iPhoneに「SonoBus」をインストール
      ※PCとiPhoneを同じWi-Fiに接続すること
2--⃣ PC側設定（SonoBus）
    1.SonoBusの起動
    2.Setup Audio を開く
    3.Input Device → 規定スピーカー
      ※（PC音をiPhoneへ送る設定）
    4.Output Device → CABLE Input (VB-Audio Virtual Cable)
      ※（iPhoneからのマイク音をMOAVLinkに渡す用の設定）
    5.Connect... でセッション名を入力して接続
3-- iPhone側設定（SonoBus）
     1.特別な設定は不要（自動で マイク入力 → スピーカー出力）
       ※ただし、初回はマイクが ミュートになっているので解除すること！
        （赤文字で警告文が出ているので警告ボタンを押すと解除される）
     2.Connect... PC側で設定したセッション名を入力して接続
4--⃣ Windowsサウンド設定
    1.既定の入力デバイス → CABLE Output (VB-Audio Virtual Cable)
    （MOAVLinkがiPhoneマイク音を拾う用になる）
5-- MOAVLink設定
    1.config.ini の [RECORDER] セクションにて
      mic_device_index = (CABLE Output のID)
      ※マイクインデックス取得処理.bat で確認した番号を入れる
6-- 実行確認
    1.iPhoneで喋る → PC側MOAVLinkが音声認識する
    2.PCで音楽を流す → iPhoneのイヤホンから聞こえる



